<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Meta tags essentiels -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Interface de messagerie MessagerieApp">
    <meta name="robots" content="noindex, nofollow">
    
    <title>Messagerie - MessagerieApp</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/dashboard.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="images/logo.svg">
</head>
<body class="dashboard-page">
    <!-- En-tête de l'application -->
    <header class="app-header" role="banner">
        <div class="header-content">
            <!-- Logo et titre -->
            <div class="header-left">
                <img src="images/logo.svg" alt="MessagerieApp" class="logo-small" width="40" height="40">
                <h1 class="app-title">MessagerieApp</h1>
            </div>
            
            <!-- Informations utilisateur et actions -->
            <div class="header-right">
                <!-- Badge admin (si applicable) -->
                <span id="userRole" class="user-role hidden" aria-label="Administrateur">
                    <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    Admin
                </span>
                
                <!-- Nom utilisateur -->
                <div class="user-info">
                    <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span id="userName" class="user-name">Utilisateur</span>
                </div>
                
                <!-- Bouton de déconnexion -->
                <button id="logoutButton" class="btn btn-secondary" aria-label="Se déconnecter">
                    <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span class="btn-text">Déconnexion</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Contenu principal -->
    <main class="dashboard-main" role="main">
        <div class="dashboard-container">
            <!-- Panneau des conversations (gauche) -->
            <aside class="conversations-panel" role="complementary" aria-label="Liste des conversations">
                <!-- En-tête du panneau -->
                <header class="panel-header">
                    <h2 class="panel-title">
                        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Conversations
                    </h2>
                    <!-- Compteur de messages non lus -->
                    <span id="unreadCount" class="badge badge-error hidden" aria-label="Messages non lus">0</span>
                </header>
                
                <!-- Liste des conversations -->
                <div id="conversationsList" class="conversations-list" role="list">
                    <!-- Les conversations seront insérées ici par JavaScript -->
                </div>
                
                <!-- État vide -->
                <div id="conversationsEmpty" class="empty-state hidden">
                    <p>Aucune conversation</p>
                </div>
            </aside>

            <!-- Panneau des messages (droite) -->
            <section class="messages-panel" role="region" aria-label="Zone de messages">
                <!-- État initial : aucune conversation sélectionnée -->
                <div id="emptyState" class="empty-state">
                    <svg class="empty-icon" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <p class="empty-text">Sélectionnez une conversation pour commencer</p>
                </div>

                <!-- Container de chat (caché par défaut) -->
                <div id="chatContainer" class="chat-container hidden">
                    <!-- En-tête de la conversation -->
                    <header class="chat-header">
                        <div class="chat-user-info">
                            <h3 id="chatUserName" class="chat-user-name">Nom utilisateur</h3>
                            <p id="chatUserEmail" class="chat-user-email">email@example.com</p>
                        </div>
                        <!-- Statut en ligne (optionnel) -->
                        <div id="chatUserStatus" class="user-status hidden">
                            <span class="status-indicator"></span>
                            <span class="status-text">En ligne</span>
                        </div>
                    </header>

                    <!-- Zone des messages -->
                    <div id="messagesList" class="messages-list" role="log" aria-live="polite" aria-atomic="false">
                        <!-- Les messages seront insérés ici -->
                    </div>

                    <!-- Indicateur de saisie -->
                    <div id="typingIndicator" class="typing-indicator hidden" role="status" aria-live="polite">
                        <span class="typing-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </span>
                        <span class="typing-text">est en train d'écrire...</span>
                    </div>

                    <!-- Indicateur de chargement -->
                    <div id="loadingIndicator" class="loading-indicator hidden" role="status" aria-live="polite">
                        <div class="spinner"></div>
                        <span>Chargement...</span>
                    </div>

                    <!-- Zone de saisie de message -->
                    <footer class="message-input-container">
                        <!-- Input fichier caché pour les images -->
                        <input 
                            type="file" 
                            id="imageInput" 
                            accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" 
                            class="hidden"
                            aria-label="Sélectionner une image"
                        >
                        
                        <!-- Bouton pour envoyer une image -->
                        <button 
                            id="imageButton" 
                            class="btn btn-icon" 
                            title="Envoyer une image"
                            aria-label="Envoyer une image"
                        >
                            <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                        </button>
                        
                        <!-- Champ de saisie du message -->
                        <input 
                            type="text" 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="Tapez votre message..."
                            autocomplete="off"
                            maxlength="5000"
                            aria-label="Saisir un message"
                        >
                        
                        <!-- Bouton d'envoi -->
                        <button 
                            id="sendButton" 
                            class="btn btn-primary btn-send"
                            aria-label="Envoyer le message"
                        >
                            <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                            <span class="btn-text">Envoyer</span>
                        </button>
                    </footer>
                </div>
            </section>
        </div>
    </main>

    <!-- Socket.io CDN -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Scripts de l'application -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/socket.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/validation.js"></script>
    <script src="js/services/imageHandler.js"></script>
    <script src="js/services/expirationManager.js"></script>
    <script src="js/ui/messageRenderer.js"></script>
    <script src="js/ui/conversationList.js"></script>
    <script src="js/ui/notifications.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Protection contre le clic droit et captures d'écran -->
    <script>
        /**
         * Désactive le menu contextuel sur les images
         */
        document.addEventListener('contextmenu', function(e) {
            if (e.target.tagName === 'CANVAS' || e.target.closest('.message-image-container')) {
                e.preventDefault();
                return false;
            }
        });

        /**
         * Bloque les raccourcis clavier de capture d'écran
         * - PrintScreen (Windows)
         * - Cmd+Shift+3/4/5 (Mac)
         */
        document.addEventListener('keydown', function(e) {
            // PrintScreen ou raccourcis Mac de screenshot
            if ((e.metaKey && e.shiftKey && [51, 52, 53].includes(e.keyCode)) || 
                e.keyCode === 44) {
                if (document.querySelector('.message-image-container')) {
                    e.preventDefault();
                    console.log('Capture d\'écran désactivée pour protéger les images');
                    return false;
                }
            }
        });

        /**
         * Désactive le glisser-déposer des images
         */
        document.addEventListener('dragstart', function(e) {
            if (e.target.tagName === 'CANVAS' || e.target.closest('.message-image-container')) {
                e.preventDefault();
                return false;
            }
        });

        /**
         * Désactive la sélection de texte sur les canvas
         */
        document.addEventListener('selectstart', function(e) {
            if (e.target.tagName === 'CANVAS') {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>